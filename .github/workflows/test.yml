name: Test

on:
  pull_request:
    branches: [ "main" ]

jobs:
  pull-request:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4

      - name: set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: gradle

      - name: Build
        uses: burrunan/gradle-cache-action@v1
        with:
          arguments: verifyPaparazziDebug -PskipRelease

      - name: Upload failed tests
        if: ${{ failure() }}
        uses: edunad/actions-image@v2.0.3
        with:
          path: './**/build/paparazzi/failures/delta-*.png'
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          title: 'Failed screenshot tests ðŸ™€'
          annotationLevel: 'failure'
